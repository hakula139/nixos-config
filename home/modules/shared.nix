{
  config,
  pkgs,
  lib,
  ...
}:

# ==============================================================================
# Shared Environment
# ==============================================================================

let
  tooling = import ../../lib/tooling.nix { inherit pkgs; };
in
{
  home.packages =
    with pkgs;
    [
      # ------------------------------------------------------------------------
      # C/C++
      # ------------------------------------------------------------------------
      ccache
      cmake
      gnumake
      ninja
      pkg-config
      llvmPackages.clang
      llvmPackages.clang-tools
      llvmPackages.lld
      llvmPackages.lldb

      # ------------------------------------------------------------------------
      # Python
      # ------------------------------------------------------------------------
      python3
      python3Packages.pip
      poetry
      ruff
      uv

      # ------------------------------------------------------------------------
      # Node.js
      # ------------------------------------------------------------------------
      fnm

      # ------------------------------------------------------------------------
      # Go
      # ------------------------------------------------------------------------
      go
      gopls

      # ------------------------------------------------------------------------
      # Rust
      # ------------------------------------------------------------------------
      rustup

      # ------------------------------------------------------------------------
      # Java
      # ------------------------------------------------------------------------
      jdk21

      # ------------------------------------------------------------------------
      # Haskell
      # ------------------------------------------------------------------------
      ghc
      cabal-install
      stack

      # ------------------------------------------------------------------------
      # Containers & Kubernetes
      # ------------------------------------------------------------------------
      podman
      podman-compose
      kubectl
      kubernetes-helm
      k9s
      kubectx

      # ------------------------------------------------------------------------
      # Other Tools
      # ------------------------------------------------------------------------
      jq
      yq
      httpie
    ]
    ++ tooling.nix
    ++ tooling.secrets;

  # ============================================================================
  # Environment Variables (shared)
  # ============================================================================
  home.sessionVariables = {
    # Node.js
    PNPM_HOME = "${config.xdg.dataHome}/pnpm";

    # Go
    GOPATH = "$HOME/go";

    # Rust
    RUSTUP_HOME = "$HOME/.rustup";
    CARGO_HOME = "$HOME/.cargo";
    RUSTUP_UPDATE_ROOT = "https://mirrors.tuna.tsinghua.edu.cn/rustup/rustup";
    RUSTUP_DIST_SERVER = "https://mirrors.tuna.tsinghua.edu.cn/rustup";
  };

  # ============================================================================
  # PATH additions (shared)
  # ============================================================================
  home.sessionPath = [
    "${config.xdg.dataHome}/pnpm"
    "$HOME/go/bin"
    "$HOME/.cargo/bin"
    "$HOME/.local/bin"
  ];

  # ============================================================================
  # Shell Configuration for Dev Tools
  # ============================================================================
  programs.zsh.initContent = lib.mkAfter ''
    # --------------------------------------------------------------------------
    # fnm (Fast Node Manager) - replacement for nvm
    # --------------------------------------------------------------------------
    if command -v fnm &>/dev/null; then
      eval "$(fnm env --use-on-cd)"
    fi

    # --------------------------------------------------------------------------
    # Corepack - Enable pnpm with per-project version management
    # --------------------------------------------------------------------------
    if command -v corepack &>/dev/null; then
      corepack enable pnpm 2>/dev/null
    fi
  '';
}
